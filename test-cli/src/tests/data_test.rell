@test module;

import tests.data;

function test_add_user() {
    require( data.user@*{}(.name) == list<text>(), 'expected_no_users' );

    val tx = rell.gtx.tx(data.add_user('Bob'));
    require( data.user@*{}(.name) == list<text>(), 'expected_no_users' );

    tx.run();
    require( data.user@*{}(.name) == ['Bob'], 'expected_user_bob' );
}

function test_remove_user() {
    rell.gtx.tx([data.add_user('Bob'), data.add_user('Alice')]).run();
    require( data.user@*{}(.name) == ['Bob', 'Alice'], 'expected_users_bob_alice_1' );

    val tx = rell.gtx.tx(data.remove_user('Bob'));
    require( data.user@*{}(.name) == ['Bob', 'Alice'], 'expected_users_bob_alice_2' );

    tx.run();
    require( data.user@*{}(.name) == ['Alice'], 'expected_user_alice' );
}
